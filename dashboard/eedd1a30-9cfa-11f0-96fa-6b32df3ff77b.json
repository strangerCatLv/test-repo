{
  "entityType" : "DASHBOARD",
  "entity" : {
    "title" : "device provisioning",
    "image" : null,
    "mobileHide" : false,
    "mobileOrder" : null,
    "configuration" : {
      "description" : "",
      "widgets" : {
        "f4dd3ce1-dd1c-94c6-5808-860b1f6d2978" : {
          "typeFullFqn" : "system.cards.entities_table",
          "type" : "latest",
          "sizeX" : 7.5,
          "sizeY" : 6.5,
          "config" : {
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 86400000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1738221302124,
                  "endTimeMs" : 1738307702124
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "NONE",
                "limit" : 200
              }
            },
            "showTitle" : true,
            "backgroundColor" : "rgb(255, 255, 255)",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "4px",
            "settings" : {
              "entitiesTitle" : "ALL DEVICES",
              "enableSearch" : true,
              "enableSelectColumnDisplay" : true,
              "enableStickyHeader" : true,
              "enableStickyAction" : true,
              "showCellActionsMenu" : true,
              "reserveSpaceForHiddenAction" : "true",
              "displayEntityName" : false,
              "entityNameColumnTitle" : "",
              "displayEntityLabel" : false,
              "entityLabelColumnTitle" : "",
              "displayEntityType" : false,
              "displayPagination" : true,
              "defaultPageSize" : 10,
              "pageStepCount" : 3,
              "pageStepIncrement" : 10,
              "defaultSortOrder" : "name",
              "useRowStyleFunction" : false,
              "rowStyleFunction" : ""
            },
            "title" : "ALL DEVICES",
            "dropShadow" : true,
            "enableFullscreen" : true,
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400,
              "padding" : "5px 10px 5px 10px"
            },
            "useDashboardTimewindow" : false,
            "showLegend" : false,
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "entityAliasId" : "131c2729-0e12-a73a-4b43-84d7b5d24315",
              "filterId" : null,
              "dataKeys" : [ {
                "name" : "name",
                "type" : "entityField",
                "label" : "Name",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.023343604961780562
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "displayTimewindow" : false,
            "configMode" : "advanced",
            "actions" : { },
            "showTitleIcon" : false,
            "titleIcon" : "list",
            "iconColor" : null,
            "titleFont" : null,
            "titleColor" : null,
            "enableDataExport" : true,
            "titleTooltip" : "",
            "widgetStyle" : { },
            "widgetCss" : "",
            "pageSize" : 1024,
            "noDataDisplayMessage" : ""
          },
          "row" : 0,
          "col" : 0,
          "id" : "f4dd3ce1-dd1c-94c6-5808-860b1f6d2978"
        },
        "7f2ce774-59b7-0eb5-934f-c1a0a120ab95" : {
          "typeFullFqn" : "system.input_widgets.device_claiming_widget",
          "type" : "static",
          "sizeX" : 7.5,
          "sizeY" : 4.5,
          "config" : {
            "datasources" : [ {
              "type" : "static",
              "name" : "function",
              "dataKeys" : [ {
                "name" : "f(x)",
                "type" : "function",
                "label" : "Random",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.15479322438769105,
                "funcBody" : "var value = prevValue + Math.random() * 100 - 50;\nvar multiplier = Math.pow(10, 2 || 0);\nvar value = Math.round(value * multiplier) / multiplier;\nif (value < -1000) {\n\tvalue = -1000;\n} else if (value > 1000) {\n\tvalue = 1000;\n}\nreturn value;"
              } ]
            } ],
            "timewindow" : {
              "realtime" : {
                "timewindowMs" : 60000
              }
            },
            "showTitle" : true,
            "backgroundColor" : "rgb(255, 255, 255)",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "8px",
            "settings" : {
              "widgetTitle" : "SCAN QR",
              "labelClaimButon" : "",
              "deviceSecret" : true,
              "showLabel" : true,
              "deviceLabel" : "",
              "secretKeyLabel" : "",
              "successfulClaimDevice" : "",
              "deviceNotFound" : "",
              "failedClaimDevice" : "",
              "requiredErrorDevice" : "",
              "requiredErrorSecretKey" : "",
              "relateDevice" : false,
              "relateDirection" : "to",
              "relateType" : "Contains"
            },
            "title" : "Device claiming widget",
            "dropShadow" : true,
            "showTitleIcon" : false,
            "titleIcon" : "more_horiz",
            "iconColor" : "rgba(0, 0, 0, 0.87)",
            "iconSize" : "24px",
            "titleTooltip" : "",
            "enableFullscreen" : false,
            "enableDataExport" : true,
            "widgetStyle" : { },
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "useDashboardTimewindow" : true,
            "displayTimewindow" : true,
            "showLegend" : false,
            "actions" : {
              "headerButton" : [ {
                "name" : "QR",
                "buttonType" : "icon",
                "icon" : "more_horiz",
                "buttonColor" : "rgba(0, 0, 0, 0.87)",
                "customButtonStyle" : { },
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "mobileAction",
                "mobileAction" : {
                  "type" : "scanQrCode",
                  "handleEmptyResultFunction" : "// Optional function body to handle empty result. \n// Usually this happens when user cancels the action (for ex. by pressing phone back button). \n\nshowEmptyResultDialog('Scan QR code action was canceled!');\n\nfunction showEmptyResultDialog(message) {\n    setTimeout(function() {\n        widgetContext.showInfoToast(message).subscribe();\n    }, 100);\n}\n",
                  "handleErrorFunction" : "// Optional function body to handle error occurred while mobile action execution \n// - error - Error message\n\nshowErrorDialog('Failed to scan QR code', error);\n\nfunction showErrorDialog(title, error) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, error).subscribe();\n    }, 100);\n}\n",
                  "processQrCodeFunction" : "// Function body to process result of QR code scanning. \n// - code - scanned QR code\n// - format - scanned QR code format\n\nshowQrCodeDialog('QR Code', code, format);\n\nfunction showQrCodeDialog(title, code, format) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, 'Code: ['+code+']<br>Format: ' + format).subscribe();\n    }, 100);\n}\n"
                },
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "4aa8c3e9-47bd-aea6-a55a-692f386d101e"
              } ]
            }
          },
          "row" : 0,
          "col" : 0,
          "id" : "7f2ce774-59b7-0eb5-934f-c1a0a120ab95"
        },
        "af12b1a5-aaa3-d308-fa5a-d4d7c64db04c" : {
          "typeFullFqn" : "system.action_button",
          "type" : "latest",
          "sizeX" : 3,
          "sizeY" : 1,
          "config" : {
            "datasources" : [ {
              "type" : "entity",
              "entityAliasId" : "131c2729-0e12-a73a-4b43-84d7b5d24315",
              "dataKeys" : [ ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1759113230910,
                  "endTimeMs" : 1759199630910
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "AVG",
                "limit" : 25000
              }
            },
            "showTitle" : false,
            "backgroundColor" : "#FFFFFF01",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "0px",
            "settings" : {
              "activatedState" : {
                "action" : "DO_NOTHING",
                "defaultValue" : true,
                "getAttribute" : {
                  "key" : "state",
                  "scope" : null
                },
                "getTimeSeries" : {
                  "key" : "state"
                },
                "getAlarmStatus" : {
                  "severityList" : null,
                  "typeList" : null
                },
                "dataToValue" : {
                  "type" : "NONE",
                  "compareToValue" : "76b0f090-9a85-11ef-8268-b3103611f169",
                  "dataToValueFunction" : "/* Should return boolean value */\nreturn data;"
                },
                "executeRpc" : {
                  "method" : null,
                  "requestTimeout" : null,
                  "requestPersistent" : null,
                  "persistentPollingInterval" : null
                }
              },
              "disabledState" : {
                "action" : "DO_NOTHING",
                "defaultValue" : false,
                "getAttribute" : {
                  "key" : "state",
                  "scope" : null
                },
                "getTimeSeries" : {
                  "key" : "state"
                },
                "getAlarmStatus" : {
                  "severityList" : null,
                  "typeList" : null
                },
                "dataToValue" : {
                  "type" : "NONE",
                  "compareToValue" : true,
                  "dataToValueFunction" : "/* Should return boolean value */\nreturn data;"
                }
              },
              "appearance" : {
                "type" : "outlined",
                "showLabel" : true,
                "label" : "Dashboard",
                "showIcon" : true,
                "icon" : "mdi:monitor-dashboard",
                "iconSize" : 24,
                "iconSizeUnit" : "px",
                "mainColor" : "var(--tb-primary-900)",
                "backgroundColor" : "#FFFFFF",
                "autoScale" : true,
                "customStyle" : {
                  "enabled" : {
                    "overrideMainColor" : true,
                    "mainColor" : "var(--tb-primary-900)",
                    "overrideBackgroundColor" : true,
                    "backgroundColor" : "#FFFFFF",
                    "overrideDropShadow" : false
                  },
                  "hovered" : {
                    "overrideMainColor" : true,
                    "mainColor" : "var(--tb-primary-900)",
                    "overrideBackgroundColor" : true,
                    "backgroundColor" : "#FFFFFF",
                    "overrideDropShadow" : false
                  },
                  "pressed" : {
                    "overrideMainColor" : true,
                    "mainColor" : "var(--tb-primary-900)",
                    "overrideBackgroundColor" : true,
                    "backgroundColor" : "#FFFFFF"
                  },
                  "activated" : {
                    "overrideMainColor" : true,
                    "mainColor" : "var(--tb-primary-900)",
                    "overrideBackgroundColor" : true,
                    "backgroundColor" : "#FFFFFF"
                  },
                  "disabled" : {
                    "overrideMainColor" : true,
                    "mainColor" : "rgb(67, 91, 99)",
                    "overrideBackgroundColor" : true,
                    "backgroundColor" : "rgb(255, 255, 255)"
                  }
                }
              }
            },
            "title" : "Action button",
            "showTitleIcon" : false,
            "iconColor" : "rgba(0, 0, 0, 0.87)",
            "iconSize" : "24px",
            "titleTooltip" : "",
            "dropShadow" : false,
            "enableFullscreen" : false,
            "enableDataExport" : false,
            "widgetStyle" : { },
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "showLegend" : false,
            "useDashboardTimewindow" : true,
            "displayTimewindow" : true,
            "widgetCss" : "",
            "pageSize" : 1024,
            "noDataDisplayMessage" : "",
            "borderRadius" : "4px",
            "configMode" : "advanced",
            "actions" : {
              "click" : [ {
                "name" : "dash",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "openDashboard",
                "targetDashboardStateId" : "",
                "setEntityId" : true,
                "stateEntityParamName" : null,
                "openNewBrowserTab" : false,
                "targetDashboardId" : "3b80bcb0-9da6-11f0-96fa-6b32df3ff77b",
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "4d4e1e24-7459-c04a-e0d2-484704881990"
              } ]
            }
          },
          "row" : 0,
          "col" : 0,
          "id" : "af12b1a5-aaa3-d308-fa5a-d4d7c64db04c"
        },
        "143f9a9f-deb2-4895-1961-c0dfc4a0e85b" : {
          "typeFullFqn" : "system.entity_count",
          "type" : "latest",
          "sizeX" : 3.5,
          "sizeY" : 1.5,
          "config" : {
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "entityAliasId" : "131c2729-0e12-a73a-4b43-84d7b5d24315",
              "dataKeys" : [ {
                "name" : "ADD ASSET",
                "type" : "entityField",
                "label" : "ADD ASSET",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.4911300593301775
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ],
                "assignedToCurrentUser" : false,
                "assigneeId" : null
              }
            } ],
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1721023145289,
                  "endTimeMs" : 1721109545289
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "AVG",
                "limit" : 25000
              }
            },
            "showTitle" : false,
            "backgroundColor" : "rgb(255, 255, 255)",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "0px",
            "settings" : {
              "layout" : "column",
              "autoScale" : false,
              "showLabel" : true,
              "label" : "ADD NEW ROOM",
              "labelFont" : {
                "family" : "Roboto",
                "size" : 14,
                "sizeUnit" : "px",
                "style" : "normal",
                "weight" : "500",
                "lineHeight" : "1.5"
              },
              "labelColor" : {
                "type" : "constant",
                "color" : "rgb(0, 0, 0)",
                "colorFunction" : "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';",
                "gradient" : {
                  "advancedMode" : false,
                  "gradient" : [ "rgba(0, 255, 0, 1)", "rgba(255, 0, 0, 1)" ],
                  "gradientAdvanced" : [ {
                    "source" : {
                      "type" : "constant"
                    },
                    "color" : "rgba(0, 255, 0, 1)"
                  }, {
                    "source" : {
                      "type" : "constant"
                    },
                    "color" : "rgba(255, 0, 0, 1)"
                  } ],
                  "minValue" : 0,
                  "maxValue" : 100
                },
                "rangeList" : {
                  "advancedMode" : false,
                  "range" : [ ],
                  "rangeAdvanced" : [ ]
                }
              },
              "showIcon" : true,
              "iconSize" : 30,
              "iconSizeUnit" : "px",
              "icon" : "home",
              "iconColor" : {
                "type" : "constant",
                "color" : "rgba(255, 255, 255, 1)",
                "colorFunction" : "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
              },
              "showIconBackground" : true,
              "iconBackgroundSize" : 35,
              "iconBackgroundSizeUnit" : "px",
              "iconBackgroundColor" : {
                "type" : "constant",
                "color" : "rgb(241, 141, 23)",
                "colorFunction" : "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';",
                "rangeList" : {
                  "advancedMode" : false,
                  "range" : [ ]
                }
              },
              "valueFont" : {
                "family" : "Roboto",
                "size" : 20,
                "sizeUnit" : "px",
                "style" : "normal",
                "weight" : "500",
                "lineHeight" : "24px"
              },
              "valueColor" : {
                "type" : "constant",
                "color" : "rgba(0, 0, 0, 0.87)",
                "colorFunction" : "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
              },
              "showChevron" : false
            },
            "title" : "Entity count",
            "dropShadow" : false,
            "enableFullscreen" : false,
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "units" : "",
            "decimals" : null,
            "useDashboardTimewindow" : true,
            "showLegend" : false,
            "widgetStyle" : { },
            "actions" : {
              "cardClick" : [ {
                "name" : "ADD NEW ASSET",
                "icon" : "more_horiz",
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "customPretty",
                "customHtml" : "<!--========================================================================-->\r\n<!--=========================  Add entity example  =========================-->\r\n<!--========================================================================-->\r\n<!---->\r\n<form #addEntityForm=\"ngForm\" [formGroup]=\"addEntityFormGroup\"\r\n      (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n        <h2>Add New Building</h2>\r\n        <span fxFlex></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n    </mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n    <div mat-dialog-content fxLayout=\"column\">\r\n        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">\r\n            <mat-form-field fxFlex class=\"mat-block\">\r\n                <mat-label>Building Name</mat-label>\r\n                <input matInput formControlName=\"entityName\" required>\r\n                <mat-error *ngIf=\"addEntityFormGroup.get('entityName').hasError('required')\">\r\n                    Building Name is required.\r\n                </mat-error>\r\n            </mat-form-field>\r\n        </div>\r\n        <!--<div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\r\n        <!--    <tb-entity-subtype-autocomplete-->\r\n        <!--            fxFlex *ngIf=\"addEntityFormGroup.get('entityType').value == 'ASSET'\"-->\r\n        <!--            class=\"mat-block\"-->\r\n        <!--            formControlName=\"type\"-->\r\n        <!--            [required]=\"true\"-->\r\n        <!--            [entityType]=\"'ASSET'\"-->\r\n        <!--    ></tb-entity-subtype-autocomplete>-->\r\n        <!--</div>-->\r\n        <!--<div formGroupName=\"attributes\" fxLayout=\"column\">-->\r\n        <!--    <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\r\n        <!--        <mat-form-field fxFlex class=\"mat-block\">-->\r\n        <!--            <mat-label>Latitude</mat-label>-->\r\n        <!--            <input type=\"number\" step=\"any\" matInput formControlName=\"latitude\">-->\r\n        <!--        </mat-form-field>-->\r\n        <!--        <mat-form-field fxFlex class=\"mat-block\">-->\r\n        <!--            <mat-label>Longitude</mat-label>-->\r\n        <!--            <input type=\"number\" step=\"any\" matInput formControlName=\"longitude\">-->\r\n        <!--        </mat-form-field>-->\r\n        <!--    </div>-->\r\n        <!--    <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\r\n        <!--        <mat-form-field fxFlex class=\"mat-block\">-->\r\n        <!--            <mat-label>Address</mat-label>-->\r\n        <!--            <input matInput formControlName=\"address\">-->\r\n        <!--        </mat-form-field>-->\r\n        <!--        <mat-form-field fxFlex class=\"mat-block hidden-total-device\">-->\r\n        <!--            <mat-label>Total Device</mat-label>-->\r\n        <!--            <input type=\"number\" step=\"any\"  matInput formControlName=\"disabled\">-->\r\n        <!--        </mat-form-field>-->\r\n        <!--    </div>-->\r\n        <!--</div>-->\r\n        <!--<div class=\"relations-list\">-->\r\n        <!--    <div class=\"mat-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">Relations</div>-->\r\n        <!--    <div class=\"body\" [fxShow]=\"relations().length\">-->\r\n        <!--        <div class=\"row\" fxLayout=\"row\" fxLayoutAlign=\"start center\" formArrayName=\"relations\" *ngFor=\"let relation of relations().controls; let i = index;\">-->\r\n        <!--            <div [formGroupName]=\"i\" class=\"mat-elevation-z2\" fxFlex fxLayout=\"row\" style=\"padding: 5px 0 5px 5px;\">-->\r\n        <!--                <div fxFlex fxLayout=\"column\">-->\r\n        <!--                    <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\r\n        <!--                        <mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\r\n        <!--                            <mat-label>Direction</mat-label>-->\r\n        <!--                            <mat-select formControlName=\"direction\" name=\"direction\">-->\r\n        <!--                                <mat-option *ngFor=\"let direction of entitySearchDirection | keyvalue\" [value]=\"direction.value\">-->\r\n        <!--                                    {{ (\"relation.search-direction.\" + direction.value) | translate}}-->\r\n        <!--                                </mat-option>-->\r\n        <!--                            </mat-select>-->\r\n        <!--                            <mat-error *ngIf=\"relation.get('direction').hasError('required')\">-->\r\n        <!--                                Relation direction is required.-->\r\n        <!--                            </mat-error>-->\r\n        <!--                        </mat-form-field>-->\r\n        <!--                        <tb-relation-type-autocomplete-->\r\n        <!--                                fxFlex class=\"mat-block\"-->\r\n        <!--                                formControlName=\"relationType\"-->\r\n        <!--                                [required]=\"true\">-->\r\n        <!--                        </tb-relation-type-autocomplete>-->\r\n        <!--                    </div>-->\r\n        <!--                    <div fxLayout=\"row\" fxLayout.xs=\"column\">-->\r\n        <!--                        <tb-entity-select-->\r\n        <!--                                fxFlex class=\"mat-block\"-->\r\n        <!--                                [required]=\"true\"-->\r\n        <!--                                formControlName=\"relatedEntity\">-->\r\n        <!--                        </tb-entity-select>-->\r\n        <!--                    </div>-->\r\n                            \r\n                            \r\n                             <!--<mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\r\n                             <!--       <mat-label>testing</mat-label>-->\r\n                             <!--       <mat-select formControlName=\"relatedEntity\" name=\"relatedEntity\">-->\r\n                             <!--           <mat-option *ngFor=\"let relatedEntity of searchRelatedEntity | keyvalue\" [value]=\"relatedEntity.value\">-->\r\n                             <!--               {{ (\"relation.search-relatedEntity.\" + relatedEntity.value) | translate}}-->\r\n                             <!--           </mat-option>-->\r\n                             <!--       </mat-select>-->\r\n                             <!--       <mat-error *ngIf=\"relation.get('relatedEntity').hasError('required')\">-->\r\n                             <!--           relatedEntity is required.-->\r\n                             <!--       </mat-error>-->\r\n                             <!--   </mat-form-field>-->\r\n                                \r\n        <!--                </div>-->\r\n        <!--                <div fxLayout=\"column\" fxLayoutAlign=\"center center\">-->\r\n        <!--                    <button mat-icon-button color=\"primary\"-->\r\n        <!--                            aria-label=\"Remove\"-->\r\n        <!--                            type=\"button\"-->\r\n        <!--                            (click)=\"removeRelation(i)\"-->\r\n        <!--                            matTooltip=\"Remove relation\"-->\r\n        <!--                            matTooltipPosition=\"above\">-->\r\n        <!--                        <mat-icon>close</mat-icon>-->\r\n        <!--                    </button>-->\r\n        <!--                </div>-->\r\n        <!--            </div>-->\r\n        <!--        </div>-->\r\n        <!--    </div>-->\r\n        <!--    <div>-->\r\n        <!--        <button mat-raised-button color=\"primary\"-->\r\n        <!--                type=\"button\"-->\r\n        <!--                (click)=\"addRelation()\"-->\r\n        <!--                matTooltip=\"Add Relation\"-->\r\n        <!--                matTooltipPosition=\"above\"-->\r\n        <!--                [disabled]=\"relations().length >= 1\">-->\r\n        <!--            Add-->\r\n        <!--        </button>-->\r\n        <!--    </div>-->\r\n        <!--</div>-->\r\n    </div>\r\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n        <button mat-button color=\"primary\"\r\n                type=\"button\"\r\n                [disabled]=\"(isLoading$ | async)\"\r\n                (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n        </button>\r\n        <button mat-button mat-raised-button color=\"primary\"\r\n                type=\"submit\"\r\n                [disabled]=\"(isLoading$ | async) || addEntityForm.invalid || !addEntityForm.dirty\">\r\n            Create\r\n        </button>\r\n    </div>\r\n</form>",
                "customCss" : ".add-entity-form{\n    width: 600px;\n}\n\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n\n\n.hidden-total-device {\n    display: none; /* Menghapus elemen dari tata letak */\n}\n",
                "customFunction" : "\r\n/*========================================================================*/\r\n/*=========================  Add entity example  =========================*/\r\n/*========================================================================*/\r\n//\r\nlet $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\n\r\nopenAddEntityDialog();\r\n\r\nfunction openAddEntityDialog() {\r\n    customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n    let vm = instance;\r\n    vm.hideTotalDevice = true;\r\n\r\n    vm.allowedEntityTypes = ['ASSET', 'DEVICE'];\r\n    vm.entitySearchDirection = {\r\n        from: \"FROM\"\r\n    };\r\n    \r\n    vm.searchRelatedEntity = {\r\n        asset : \"ASSET\",\r\n        Other : 'Other'\r\n    };\r\n    \r\n    \r\n    vm.addEntityFormGroup = vm.fb.group({\r\n     entityName: ['', [vm.validators.required]],\r\n     entityType: ['ASSET'],\r\n     entityLabel: [null],\r\n    //  type: ['', [vm.validators.required]],\r\n    type : \"LANTAI\",\r\n     attributes: vm.fb.group({\r\n         latitude: [null],\r\n         longitude: [null],\r\n         address: [null],\r\n         relationName : [null],\r\n         disabled : [null]\r\n     }),\r\n     relations: vm.fb.array([])\r\n    });\r\n\r\n    vm.cancel = function() {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.relations = function() {\r\n        return vm.addEntityFormGroup.get('relations');\r\n    };\r\n\r\n    // vm.addRelation = function() {\r\n    //     vm.relations().push(vm.fb.group({\r\n    //      relatedEntity: [null, [vm.validators.required]],\r\n    //      relationType: [null, [vm.validators.required]],\r\n    //      direction: [null, [vm.validators.required]]\r\n    //     }));\r\n    // };\r\n    \r\n    vm.addRelation = function() {\r\n    //hanya satu relasi yang bisa ditambahkan\r\n        if (vm.relations().length === 0) {\r\n            vm.relations().push(vm.fb.group({\r\n                relatedEntity: [null, [vm.validators.required]],\r\n                relationType: ['Contains'],\r\n                direction: ['FROM']\r\n            }));\r\n        }\r\n    };\r\n    \r\n\r\n\r\n\r\n    vm.removeRelation = function(index) {\r\n        vm.relations().removeAt(index);\r\n        vm.relations().markAsDirty();\r\n    };\r\n\r\n    vm.save = function() {\r\n        vm.addEntityFormGroup.markAsPristine();\r\n        saveEntityObservable().subscribe(\r\n            function (entity) {\r\n                widgetContext.rxjs.forkJoin([\r\n                    saveAttributes(entity.id),\r\n                    saveRelations(entity.id)\r\n                ]).subscribe(\r\n                    function () {\r\n                        widgetContext.updateAliases();\r\n                        vm.dialogRef.close(null);\r\n                    }\r\n                );\r\n            }\r\n        );\r\n    };\r\n\r\n    function saveEntityObservable() {\r\n        const formValues = vm.addEntityFormGroup.value;\r\n        let entity = {\r\n            name: formValues.entityName,\r\n            type: formValues.type,\r\n            label: formValues.entityLabel\r\n        };\r\n        if (formValues.entityType == 'ASSET') {\r\n            return assetService.saveAsset(entity);\r\n        } else if (formValues.entityType == 'DEVICE') {\r\n            return deviceService.saveDevice(entity);\r\n        }\r\n    }\r\n\r\n    function saveAttributes(entityId) {\r\n        let attributes = vm.addEntityFormGroup.get('attributes').value;\r\n        let attributesArray = [];\r\n        for (let key in attributes) {\r\n            if(attributes[key] !== null) {\r\n                attributesArray.push({key: key, value: attributes[key]});\r\n            }\r\n        }\r\n        if (attributesArray.length > 0) {\r\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n        }\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n\r\n    function saveRelations(entityId) {\r\n        let relations = vm.addEntityFormGroup.get('relations').value;\r\n        let tasks = [];\r\n        for(let i=0; i < relations.length; i++) {\r\n            let relation = {\r\n                type: relations[i].relationType,\r\n                typeGroup: 'COMMON'\r\n            };\r\n            if (relations[i].direction == 'FROM') {\r\n                relation.to = relations[i].relatedEntity;\r\n                relation.from = entityId;\r\n            } else {\r\n                relation.to = entityId;\r\n                relation.from = relations[i].relatedEntity;\r\n            }\r\n            tasks.push(entityRelationService.saveRelation(relation));\r\n        }\r\n        if (tasks.length > 0) {\r\n            return widgetContext.rxjs.forkJoin(tasks);\r\n        }\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n}\r\n",
                "customResources" : [ ],
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "c9a0d011-1cf1-543e-6e9d-8bfcc477fc90"
              } ]
            },
            "configMode" : "advanced",
            "displayTimewindow" : true,
            "margin" : "0px",
            "borderRadius" : "0px",
            "widgetCss" : "",
            "pageSize" : 1024,
            "noDataDisplayMessage" : "",
            "showTitleIcon" : false,
            "titleTooltip" : "",
            "titleFont" : {
              "size" : 12,
              "sizeUnit" : "px",
              "family" : null,
              "weight" : null,
              "style" : null,
              "lineHeight" : "1"
            },
            "titleIcon" : "",
            "iconColor" : "rgba(0, 0, 0, 0.87)",
            "iconSize" : "14px",
            "timewindowStyle" : {
              "showIcon" : true,
              "iconSize" : "14px",
              "icon" : "query_builder",
              "iconPosition" : "left",
              "font" : {
                "size" : 12,
                "sizeUnit" : "px",
                "family" : null,
                "weight" : null,
                "style" : null,
                "lineHeight" : "1"
              },
              "color" : null
            },
            "titleColor" : "rgba(0, 0, 0, 0.54)",
            "enableDataExport" : false
          },
          "row" : 0,
          "col" : 0,
          "id" : "143f9a9f-deb2-4895-1961-c0dfc4a0e85b"
        },
        "5d547122-0ca8-7084-344b-b8e0ba333465" : {
          "typeFullFqn" : "system.cards.entities_table",
          "type" : "latest",
          "sizeX" : 7.5,
          "sizeY" : 6.5,
          "config" : {
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 86400000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1738221302124,
                  "endTimeMs" : 1738307702124
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "NONE",
                "limit" : 200
              }
            },
            "showTitle" : true,
            "backgroundColor" : "rgb(255, 255, 255)",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "4px",
            "settings" : {
              "entitiesTitle" : "ALL ROOM",
              "enableSearch" : true,
              "enableSelectColumnDisplay" : true,
              "enableStickyHeader" : true,
              "enableStickyAction" : true,
              "showCellActionsMenu" : true,
              "reserveSpaceForHiddenAction" : "true",
              "displayEntityName" : false,
              "entityNameColumnTitle" : "",
              "displayEntityLabel" : false,
              "entityLabelColumnTitle" : "",
              "displayEntityType" : false,
              "displayPagination" : true,
              "defaultPageSize" : 10,
              "pageStepCount" : 3,
              "pageStepIncrement" : 10,
              "defaultSortOrder" : "name",
              "useRowStyleFunction" : false,
              "rowStyleFunction" : ""
            },
            "title" : "ALL ROOM",
            "dropShadow" : true,
            "enableFullscreen" : true,
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400,
              "padding" : "5px 10px 5px 10px"
            },
            "useDashboardTimewindow" : false,
            "showLegend" : false,
            "datasources" : [ {
              "type" : "entity",
              "name" : "",
              "entityAliasId" : "76f33f21-5d98-eb94-7639-2c4f84e0285d",
              "filterId" : null,
              "dataKeys" : [ {
                "name" : "name",
                "type" : "entityField",
                "label" : "Name",
                "color" : "#2196f3",
                "settings" : { },
                "_hash" : 0.023343604961780562
              } ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "displayTimewindow" : false,
            "configMode" : "advanced",
            "actions" : { },
            "showTitleIcon" : false,
            "titleIcon" : "list",
            "iconColor" : null,
            "titleFont" : null,
            "titleColor" : null,
            "enableDataExport" : true,
            "titleTooltip" : "",
            "widgetStyle" : { },
            "widgetCss" : "",
            "pageSize" : 1024,
            "noDataDisplayMessage" : ""
          },
          "row" : 0,
          "col" : 0,
          "id" : "5d547122-0ca8-7084-344b-b8e0ba333465"
        },
        "25c698ce-9c5d-a3f3-6684-234ac9d1550b" : {
          "typeFullFqn" : "system.cards.html_value_card",
          "type" : "latest",
          "sizeX" : 7.5,
          "sizeY" : 3,
          "config" : {
            "datasources" : [ {
              "type" : "device",
              "name" : "",
              "deviceId" : "b8056670-9d0e-11f0-96fa-6b32df3ff77b",
              "dataKeys" : [ ],
              "alarmFilterConfig" : {
                "statusList" : [ "ACTIVE" ]
              }
            } ],
            "timewindow" : {
              "displayValue" : "",
              "selectedTab" : 0,
              "realtime" : {
                "realtimeType" : 1,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideQuickInterval" : false
              },
              "history" : {
                "historyType" : 0,
                "interval" : 1000,
                "timewindowMs" : 60000,
                "fixedTimewindow" : {
                  "startTimeMs" : 1759129552143,
                  "endTimeMs" : 1759215952143
                },
                "quickInterval" : "CURRENT_DAY",
                "hideInterval" : false,
                "hideLastInterval" : false,
                "hideFixedInterval" : false,
                "hideQuickInterval" : false
              },
              "aggregation" : {
                "type" : "AVG",
                "limit" : 25000
              }
            },
            "showTitle" : false,
            "backgroundColor" : "#fff",
            "color" : "rgba(0, 0, 0, 0.87)",
            "padding" : "0px",
            "settings" : {
              "cardHtml" : "<div class='card'>\n    <div class='content'>\n        <div class='column'>\n            <h1>Value title</h1>\n            <div class='value' id=\"\">\n                KLIK\n            </div>    \n            <div class='description'>\n                Value description text\n            </div>\n        </div>\n        <img height=\"80px\" src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIwIiB3aWR0aD0iMzIwIj48ZyBzdHJva2Utd2lkdGg9IjI4Ij48ZyBmaWxsPSIjMzA1NjgwIiBjb2xvcj0iIzAwMCIgd2hpdGUtc3BhY2U9Im5vcm1hbCI+PHBhdGggc3R5bGU9InRleHQtZGVjb3JhdGlvbi1jb2xvcjojMDAwO2lzb2xhdGlvbjphdXRvO21peC1ibGVuZC1tb2RlOm5vcm1hbDtibG9jay1wcm9ncmVzc2lvbjp0Yjt0ZXh0LWRlY29yYXRpb24tbGluZTpub25lO3RleHQtZGVjb3JhdGlvbi1zdHlsZTpzb2xpZDt0ZXh0LWluZGVudDowO3RleHQtdHJhbnNmb3JtOm5vbmUiIGQ9Ik0xNTEuMTMgMGMtMjguMzYzIDAtNTQuOTE1IDcuOTE1LTc3LjYxMyAyMS41MzdhMzYuNTc4IDM2LjU3OCAwIDAgMC0yMy4wNjctOC4xOTQgOC43NjYgOC43NjYgMCAwIDAtLjAwNCAwYy0yMC4xNTQuMDAxLTM2LjY3OSAxNi41MjgtMzYuNjc4IDM2LjY4MmE4Ljc2NiA4Ljc2NiAwIDAgMCAwIC4wMSAzNi42OSAzNi42OSAwIDAgMCA4LjEwNCAyMi45MjhjLTEzLjgzIDIyLjgzLTIxLjg3IDQ5LjU4LTIxLjg3IDc4LjE3YTguNzY2IDguNzY2IDAgMSAwIDE3LjUzIDBjMC0yNC43MDIgNi43Mi00Ny43NDggMTguMzc5LTY3LjU3NCA0LjU2NiAxLjk4NSA5LjQ3MiAzLjE1IDE0LjUxOSAzLjE1N2E4Ljc2NiA4Ljc2NiAwIDAgMCAuMDEyIDBjMjAuMTU1IDAgMzYuNjgzLTE2LjUyNyAzNi42ODItMzYuNjgyYTguNzY2IDguNzY2IDAgMCAwIDAtLjAwNGMtLjAwMS01LTEuMTM4LTkuODYzLTMuMDgzLTE0LjM5NyAxOS43MTctMTEuNDg0IDQyLjU4NS0xOC4wOTUgNjcuMDg1LTE4LjA5NWE4Ljc2NiA4Ljc2NiAwIDEgMCAwLTE3LjUzek01MC40NCAzMC44OGM1LjkxMy4wMDIgMTEuMTkxIDIuNTEyIDE0LjgzNiA3LjA3N2E4Ljc2NiA4Ljc2NiAwIDAgMCAuMTgzLjIxNCAxOS4xMzcgMTkuMTM3IDAgMCAxIDQuMTM0IDExLjg2M2MtLjAwMiAxMC42NzctOC40NjggMTkuMTQ0LTE5LjE0NCAxOS4xNDhhMTkuMTQ1IDE5LjE0NSAwIDAgMS0xMi00LjI1NCA4Ljc2NiA4Ljc2NiAwIDAgMC0uMDEzLS4wMSAxOS4xMzYgMTkuMTM2IDAgMCAxLTcuMTQ0LTE0Ljg5MmMuMDAzLTEwLjY3NyA4LjQ3LTE5LjE0NCAxOS4xNDgtMTkuMTQ2eiIvPjxwYXRoIHN0eWxlPSJ0ZXh0LWRlY29yYXRpb24tY29sb3I6IzAwMDtpc29sYXRpb246YXV0bzttaXgtYmxlbmQtbW9kZTpub3JtYWw7YmxvY2stcHJvZ3Jlc3Npb246dGI7dGV4dC1kZWNvcmF0aW9uLWxpbmU6bm9uZTt0ZXh0LWRlY29yYXRpb24tc3R5bGU6c29saWQ7dGV4dC1pbmRlbnQ6MDt0ZXh0LXRyYW5zZm9ybTpub25lIiBkPSJNNjYuOTkyIDEwMi44M2E4LjE4NyA4LjE4NyAwIDAgMC0yLjI1OCA2LjA3MSA4LjYwNCA4LjYwNCAwIDAgMCAyLjMzOCA1LjUxOGM2LjgwNSA2Ljg1NiAyMC4yMjMgMjAuMjIzIDIwLjIyMyAyMC4yMjNsMTEuODQ0LTExLjgzcy0xMi45NzMtMTIuOTYxLTIwLjE3Ni0yMC4xNzFjLTEuNjA0LTEuNjMyLTMuNzUtMi4zMTQtNi4wMTItMi4zMjRhOC4xNSA4LjE1IDAgMCAwLTUuOTYgMi41MTJ6bTMyLjE0NyAxOS45ODNMNjIuNSAxNTkuNDUyYy0zLjk3NSAzLjk3Ni0zLjk3NSAxMC40MjEgMCAxNC4zOTdsMTguMTU2IDE4LjE1NiAzMS43NTMgMzEuNzUzIDMwLjQ3OCAzMC40NzhjMy45NzYgMy45NzYgMTAuNDIyIDMuOTc2IDE0LjM5OCAwbDI0Ljc5MS0yNC43OTEgMzcuOTE0LTM3LjkxNCAzNi42MzktMzYuNjM5YzMuOTc1LTMuOTc2IDMuOTc1LTEwLjQyMiAwLTE0LjM5OGwtMTguNjMtMTguNjMtMzEuNzUtMzEuNzYtMzAuMDEtMzBjLTMuOTc3LTMuOTc1LTEwLjQyMi0zLjk3NS0xNC4zOTggMGwtMjQuNzkgMjQuNzktMzcuOTEgMzcuOTF6bTM3LjkxMS0zNy45MXMtMTIuOTczLTEyLjk2MS0yMC4xNzYtMjAuMTcxYy0xLjYwNC0xLjYzMi0zLjc1LTIuMzE0LTYuMDEyLTIuMzI0LTQuNzE3LS4wMjMtOC40MzQgMy44NjEtOC4yMTcgOC41ODNhOC42MDQgOC42MDQgMCAwIDAgMi4zMzcgNS41MThjNi44MDUgNi44NTYgMjAuMjIzIDIwLjIyMyAyMC4yMjMgMjAuMjIzbDExLjg0NC0xMS44M3ptNjkuMTkzIDUuMjEzczEyLjk2MS0xMi45NzMgMjAuMTcxLTIwLjE3NmMxLjYzMy0xLjYwNCAyLjMxNC0zLjc1IDIuMzI0LTYuMDEyLjAyMy00LjcxNi0zLjg2MS04LjQzNC04LjU4My04LjIxN2E4LjYwNCA4LjYwNCAwIDAgMC01LjUxOCAyLjMzOGMtNi44NTYgNi44MDUtMjAuMjIzIDIwLjIyMy0yMC4yMjMgMjAuMjIzbDExLjgzIDExLjg0NHptMzEuNzUzIDMxLjc1M3MxMi45NjEtMTIuOTczIDIwLjE3MS0yMC4xNzZjMS42MzMtMS42MDQgMi4zMTQtMy43NSAyLjMyNC02LjAxMi4wMjMtNC43MTYtMy44NjEtOC40MzQtOC41ODMtOC4yMTdhOC42MDQgOC42MDQgMCAwIDAtNS41MTggMi4zMzhjLTYuODU2IDYuODA1LTIwLjIyMyAyMC4yMjMtMjAuMjIzIDIwLjIyM2wxMS44MyAxMS44NDR6bS0xOC4wMDkgNjkuNjY3czEyLjk3MyAxMi45NjEgMjAuMTc4IDIwLjE3YzEuNjA0IDEuNjMyIDMuNzUgMi4zMTMgNi4wMTIgMi4zMjQgNC43MTcuMDIyIDguNDM0LTMuODYyIDguMjE3LTguNTg0bC0uMDAyLjAwMmE4LjYwNiA4LjYwNiAwIDAgMC0yLjMzOC01LjUxOGMtNi44MDUtNi44NTYtMjAuMjIyLTIwLjIyMi0yMC4yMjItMjAuMjIybC0xMS44NDQgMTEuODN6bS0zNy45MTQgMzcuOTE0czEyLjk3MyAxMi45NjEgMjAuMTc4IDIwLjE3YzEuNjA0IDEuNjMyIDMuNzUgMi4zMTMgNi4wMTIgMi4zMjMgNC43MTcuMDIzIDguNDM0LTMuODYxIDguMjE3LTguNTgzaC0uMDAyYTguNjAzIDguNjAzIDAgMCAwLTIuMzM3LTUuNTE4Yy02LjgwNS02Ljg1Ni0yMC4yMjMtMjAuMjIzLTIwLjIyMy0yMC4yMjNsLTExLjg0NCAxMS44M3ptLTY5LjY2Ny01LjY4N3MtMTIuOTYxIDEyLjk3My0yMC4xNjkgMjAuMTc4Yy0xLjYzMiAxLjYwNC0yLjMxNCAzLjc1LTIuMzI0IDYuMDEyLS4wMjMgNC43MTcgMy44NjEgOC40MzQgOC41ODMgOC4yMTdoLS4wMDJhOC42MDIgOC42MDIgMCAwIDAgNS41MTgtMi4zMzdjNi44NTYtNi44MDUgMjAuMjIzLTIwLjIyMyAyMC4yMjMtMjAuMjIzbC0xMS44Mi0xMS44NHptLTMxLjc0My0zMS43NHMtMTIuOTYxIDEyLjk3My0yMC4xNjkgMjAuMTc4Yy0xLjYzMiAxLjYwNC0yLjMxNCAzLjc1LTIuMzI0IDYuMDEyLS4wMjMgNC43MTcgMy44NjEgOC40MzQgOC41ODMgOC4yMTdoLS4wMDJhOC42MDQgOC42MDQgMCAwIDAgNS41MTgtMi4zMzdjNi44NTYtNi44MDUgMjAuMjIzLTIwLjIyMyAyMC4yMjMtMjAuMjIzbC0xMS44My0xMS44NXpNMTY3LjkgMTAxLjQ3YzEuNjgtMS43MDYgMy45NjctMi42NiA2LjI5Ny0yLjYyNmE3Ljg5IDcuODkgMCAwIDEgNC41NjMgMS41MWwxNi40OTkgMTIuMWMzLjIgMi4yOTcgNC4xNDQgNi42NTkgMi4yMyAxMC4zMTItMS45MTMgMy42NTMtNi4xMjMgNS41MjQtOS45NSA0LjQyM2w2LjEyNCAyMy45NDhjMS4xMTMgNC4zNTEtMS41NjQgOC45NjctNS45ODQgMTAuMzE3bC00NC42NDIgMTMuNjMgOC4yNDYgMzEuODg0YzEuMTczIDQuMzctMS41MDIgOS4wNDQtNS45NTUgMTAuNDA3cy04Ljk3NS0xLjExMS0xMC4wNjgtNS41MDVsLTEwLjI4Mi0zOS43N2MtMS4xMjYtNC4zNTUgMS41NS04Ljk4NCA1Ljk3Ni0xMC4zMzdsNDQuNjYxLTEzLjYzNy00LjEyMi0xNi4xMThjLTIuNzYzIDMuMDY0LTcuMjMzIDMuODA4LTEwLjU4NiAxLjc2MS0zLjM1My0yLjA0Ny00LjYxNC02LjI5LTIuOTg2LTEwLjA0N2w4LjExNy0xOS40NTRhOC44NzIgOC44NzIgMCAwIDEgMS44NjMtMi43OTd6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48cGF0aCBzdHlsZT0idGV4dC1kZWNvcmF0aW9uLWNvbG9yOiMwMDA7aXNvbGF0aW9uOmF1dG87bWl4LWJsZW5kLW1vZGU6bm9ybWFsO2Jsb2NrLXByb2dyZXNzaW9uOnRiO3RleHQtZGVjb3JhdGlvbi1saW5lOm5vbmU7dGV4dC1kZWNvcmF0aW9uLXN0eWxlOnNvbGlkO3RleHQtaW5kZW50OjA7dGV4dC10cmFuc2Zvcm06bm9uZSIgZD0iTTE2OC44NyAzMjAuMDRjMjguMzYzIDAgNTQuOTE1LTcuOTE1IDc3LjYxNC0yMS41MzhhMzYuNTc4IDM2LjU3OCAwIDAgMCAyMy4wNjcgOC4xOTQgOC43NjYgOC43NjYgMCAwIDAgLjAwNCAwYzIwLjE1NSAwIDM2LjY4LTE2LjUyOCAzNi42NzktMzYuNjgyYTguNzY2IDguNzY2IDAgMCAwIDAtLjAxMSAzNi42ODggMzYuNjg4IDAgMCAwLTguMTAzLTIyLjkyN2MxMy44MjUtMjIuODIgMjEuODY2LTQ5LjU3MiAyMS44NjYtNzguMTYyYTguNzY2IDguNzY2IDAgMSAwLTE3LjUzMSAwYzAgMjQuNzAzLTYuNzIgNDcuNzQ5LTE4LjM3OCA2Ny41NzUtNC41NjctMS45ODUtOS40NzMtMy4xNS0xNC41Mi0zLjE1N2E4Ljc2NiA4Ljc2NiAwIDAgMC0uMDEyIDBjLTIwLjE1NS0uMDAxLTM2LjY4MyAxNi41MjctMzYuNjgyIDM2LjY4Mi4wMDIgNC45OTkgMS4xMzkgOS44NjIgMy4wODMgMTQuMzk3LTE5LjcxNyAxMS40ODQtNDIuNTg2IDE4LjA5NS02Ny4wODYgMTguMDk1YTguNzY2IDguNzY2IDAgMSAwIDAgMTcuNTN6bTEwMC42OS0zMC44NzVjLTUuOTEzIDAtMTEuMTkxLTIuNTEyLTE0LjgzNi03LjA3N2E4Ljc2NiA4Ljc2NiAwIDAgMC0uMTgzLS4yMTQgMTkuMTM2IDE5LjEzNiAwIDAgMS00LjEzNC0xMS44NjNjLjAwMi0xMC42NzcgOC40NjgtMTkuMTQ0IDE5LjE0NC0xOS4xNDhhMTkuMTQ1IDE5LjE0NSAwIDAgMSAxMiA0LjI1NCA4Ljc2NiA4Ljc2NiAwIDAgMCAuMDEzLjAxIDE5LjEzNiAxOS4xMzYgMCAwIDEgNy4xNDQgMTQuODkyYy0uMDAzIDEwLjY3Ny04LjQ3IDE5LjE0NS0xOS4xNDggMTkuMTQ2eiIvPjwvZz48L2c+PC9zdmc+\" />\n    </div>\n</div>",
              "cardCss" : ".card {\n   width: 100%;\n   height: 100%;\n   border: 2px solid #ccc;\n   box-sizing: border-box;\n}\n\n.card .content {\n   padding: 20px;\n   display: flex;\n   flex-direction: row;\n   align-items: center;\n   justify-content: space-around;\n   height: 100%;\n   box-sizing: border-box;\n}\n\n.card .content .column {\n   display: flex;\n   flex-direction: column;    \n   justify-content: space-around;\n   height: 100%;\n}\n\n.card h1 {\n    text-transform: uppercase;\n    color: #999;\n    font-size: 20px;\n    font-weight: bold;\n    margin: 0;\n    padding-bottom: 10px;\n    line-height: 32px;\n}\n\n.card .value {\n    font-size: 38px;\n    font-weight: 200;\n}\n\n.card .description {\n    font-size: 20px;\n    color: #999;\n}\n"
            },
            "title" : "HTML Value Card",
            "dropShadow" : false,
            "enableFullscreen" : true,
            "widgetStyle" : { },
            "titleStyle" : {
              "fontSize" : "16px",
              "fontWeight" : 400
            },
            "useDashboardTimewindow" : true,
            "showLegend" : false,
            "actions" : {
              "elementClick" : [ ],
              "headerButton" : [ {
                "name" : "test",
                "buttonType" : "icon",
                "icon" : "more_horiz",
                "buttonColor" : "rgba(0, 0, 0, 0.87)",
                "customButtonStyle" : { },
                "useShowWidgetActionFunction" : null,
                "showWidgetActionFunction" : "return true;",
                "type" : "customPretty",
                "customHtml" : "<form #addResidentForm=\"ngForm\" [formGroup]=\"addResidentFormGroup\"\n      (ngSubmit)=\"add()\" class=\"al-form\">\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\n        <h2>Add resident</h2>\n        <span fxFlex></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon class=\"material-icons\">close</mat-icon>\n        </button>\n    </mat-toolbar>\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n    </mat-progress-bar>\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n    <div mat-dialog-content>\n        <section fxLayout=\"column\" fxLayoutGap=\"24px\">\n            <!--<section fxLayout=\"row\" fxLayoutGap=\"40px\">-->\n            <!--    <div class=\"al-section-title\">Personal info</div>-->\n            <!--    <section fxFlex fxLayout=\"column\">-->\n                    <!--<mat-form-field fxFlex appearance=\"fill\" class=\"mat-block\">-->\n                    <!--    <mat-label>Email</mat-label>-->\n                    <!--    <input matInput formControlName=\"email\" required>-->\n                    <!--    <mat-error *ngIf=\"addResidentFormGroup.get('email').hasError('email')\">-->\n                    <!--        Invalid email format.-->\n                    <!--    </mat-error>-->\n                    <!--    <mat-error *ngIf=\"addResidentFormGroup.get('email').hasError('required')\">-->\n                    <!--        Email is required-->\n                    <!--    </mat-error>-->\n                    <!--</mat-form-field>-->\n                    <!--<section fxFlex fxLayout=\"row\" fxLayoutGap=\"8px\">-->\n                    <!--    <mat-form-field fxFlex appearance=\"fill\" class=\"mat-block\">-->\n                    <!--        <mat-label>First name</mat-label>-->\n                    <!--        <input matInput formControlName=\"firstName\" required>-->\n                    <!--        <mat-error *ngIf=\"addResidentFormGroup.get('firstName').hasError('required')\">-->\n                    <!--            First name is required.-->\n                    <!--        </mat-error>-->\n                    <!--    </mat-form-field>-->\n                    <!--    <mat-form-field fxFlex appearance=\"fill\" class=\"mat-block\">-->\n                    <!--        <mat-label>Last name</mat-label>-->\n                    <!--        <input matInput formControlName=\"lastName\" required>-->\n                    <!--        <mat-error *ngIf=\"addResidentFormGroup.get('lastName').hasError('required')\">-->\n                    <!--            Last name is required.-->\n                    <!--        </mat-error>-->\n                    <!--    </mat-form-field>-->\n                    <!--</section>-->\n                    <!--<section fxFlex fxLayout=\"row\" fxLayoutGap=\"8px\">-->\n                    <!--    <mat-form-field fxFlex appearance=\"fill\" class=\"mat-block\">-->\n                    <!--      <mat-label>Gender</mat-label>-->\n                    <!--      <mat-select matInput formControlName=\"gender\" panelClass=\"al-form\">-->\n                    <!--        <mat-option *ngFor=\"let gender of genders\" [value]=\"gender\">-->\n                    <!--          {{ gender }}-->\n                    <!--        </mat-option>-->\n                    <!--      </mat-select>-->\n                    <!--    </mat-form-field>-->\n                    <!--    <tb-phone-input fxFlex-->\n                    <!--        appearance=\"fill\"-->\n                    <!--        [required]=\"false\"-->\n                    <!--        formControlName=\"phoneNumber\"-->\n                    <!--        [enableFlagsSelect]=\"false\"-->\n                    <!--        label=\"Phone number\">-->\n                    <!--    </tb-phone-input>-->\n                    <!--</section>-->\n                    <!--<section fxFlex fxLayout=\"row\" fxLayoutGap=\"8px\">-->\n                    <!--<mat-form-field fxFlex=\"50\" appearance=\"fill\" class=\"mat-block\">-->\n                    <!--    <mat-label>Birth</mat-label>-->\n                    <!--    <mat-datetimepicker-toggle [for]=\"birthDatePicker\" matPrefix></mat-datetimepicker-toggle>-->\n                    <!--    <mat-datetimepicker #birthDatePicker type=\"date\" startView=\"multi-year\" openOnFocus=\"true\"></mat-datetimepicker>-->\n                    <!--    <input matInput formControlName=\"birthdate\" [matDatetimepicker]=\"birthDatePicker\">-->\n                    <!--</mat-form-field>-->\n                    <!--</section>    -->\n                    <!--<tb-image-input formControlName=\"photo\" label=\"Photo\" noImageText=\"No photo selected\" required></tb-image-input>-->\n            <!--    </section>-->\n            <!--</section>-->\n            <!--<mat-divider></mat-divider>-->\n            <!--<section fxLayout=\"row\" fxLayoutGap=\"40px\">-->\n            <!--    <div class=\"al-section-title\">Emergency contact</div>-->\n            <!--    <section fxFlex fxLayout=\"column\">-->\n            <!--        <section fxFlex fxLayout=\"row\" fxLayoutGap=\"8px\">-->\n            <!--            <mat-form-field fxFlex appearance=\"fill\" class=\"mat-block\">-->\n            <!--                <mat-label>First name</mat-label>-->\n            <!--                <input matInput formControlName=\"emergencyFirstname\">-->\n            <!--            </mat-form-field>-->\n            <!--            <mat-form-field fxFlex appearance=\"fill\" class=\"mat-block\">-->\n            <!--                <mat-label>Last name</mat-label>-->\n            <!--                <input matInput formControlName=\"emergencyLastname\">-->\n            <!--            </mat-form-field>-->\n            <!--        </section>-->\n            <!--        <section fxFlex fxLayout=\"row\" fxLayoutGap=\"8px\">-->\n            <!--            <mat-form-field fxFlex appearance=\"fill\" class=\"mat-block\">-->\n            <!--                <mat-label>Role</mat-label>-->\n            <!--                <input matInput formControlName=\"emergencyRole\">-->\n            <!--            </mat-form-field>-->\n            <!--            <tb-phone-input fxFlex-->\n            <!--                appearance=\"fill\"-->\n            <!--                [required]=\"false\"-->\n            <!--                formControlName=\"emergencyPhoneNumber\"-->\n            <!--                [enableFlagsSelect]=\"false\"-->\n            <!--                label=\"Phone number\">-->\n            <!--            </tb-phone-input>-->\n            <!--        </section>-->\n            <!--    </section>    -->\n            <!--</section>    -->\n            <!--<mat-divider></mat-divider>-->\n            <!--<section fxLayout=\"row\" fxLayoutGap=\"40px\">-->\n            <!--    <div class=\"al-section-title\">Health information</div>-->\n            <!--    <section fxFlex fxLayout=\"column\">-->\n            <!--        <mat-form-field fxFlex appearance=\"fill\" class=\"mat-block\">-->\n            <!--            <mat-label>Chromic diseases</mat-label>-->\n            <!--            <input matInput formControlName=\"chronicDiseases\">-->\n            <!--        </mat-form-field>-->\n            <!--        <mat-form-field fxFlex appearance=\"fill\" class=\"mat-block\">-->\n            <!--            <mat-label>Allergy</mat-label>-->\n            <!--            <input matInput formControlName=\"allergy\">-->\n            <!--        </mat-form-field>-->\n            <!--    </section>    -->\n            <!--</section>-->\n            <mat-divider></mat-divider>\n            <section fxLayout=\"row\" fxLayoutGap=\"40px\">\n                <div class=\"al-section-title\">Location</div>\n                <section fxFlex fxLayout=\"row\" fxLayoutGap=\"8px\">\n                    <mat-form-field fxFlex=\"50\" appearance=\"fill\" class=\"mat-block\">\n                      <mat-label>Zone</mat-label>\n                      <mat-select matInput formControlName=\"zone\" required panelClass=\"al-form\">\n                        <mat-option *ngFor=\"let zone of zones$ | async\" [value]=\"zone\">\n                          {{ zone.name }}\n                        </mat-option>\n                      </mat-select>\n                      <mat-error *ngIf=\"addResidentFormGroup.get('zone').hasError('required')\">\n                          Zone is required.\n                      </mat-error>\n                    </mat-form-field>\n                    <mat-form-field [fxShow]=\"addResidentFormGroup.get('zone').value\" fxFlex=\"50\" appearance=\"fill\" floatLabel=\"always\" class=\"mat-block\">\n                      <mat-label>Room</mat-label>\n                      <mat-select matInput formControlName=\"room\" required panelClass=\"al-form\"\n                        [placeholder]=\"(rooms$ | async)?.length ? 'Please select room' : 'No rooms available in selected zone'\">\n                        <mat-option *ngFor=\"let room of rooms$ | async\" [value]=\"room\">\n                          {{ room.name }}\n                        </mat-option>\n                      </mat-select>\n                      <mat-error *ngIf=\"addResidentFormGroup.get('room').hasError('required')\">\n                          Room is required.\n                      </mat-error>\n                    </mat-form-field>\n                </section>    \n            </section>\n            <mat-divider></mat-divider>\n            <section fxLayout=\"row\" fxLayoutGap=\"40px\">\n                <div class=\"al-section-title\">Wristband</div>\n                <mat-form-field fxFlex appearance=\"fill\" class=\"mat-block\">\n                  <mat-label>Assigned wristband</mat-label>\n                  <mat-select matInput formControlName=\"wristband\" panelClass=\"al-form\" required>\n                    <mat-option *ngFor=\"let wristband of wristbands$ | async\" [value]=\"wristband\">\n                      {{ wristband.name }}\n                    </mat-option>\n                  </mat-select>\n                  <mat-error *ngIf=\"addResidentFormGroup.get('wristband').hasError('required')\">\n                      Wristband is required.\n                  </mat-error>\n                </mat-form-field>\n            </section>\n        </section>    \n    </div>\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n        <button mat-button color=\"primary\"\n                type=\"button\"\n                [disabled]=\"(isLoading$ | async)\"\n                (click)=\"cancel()\" cdkFocusInitial>\n            Cancel\n        </button>\n        <button mat-button mat-raised-button color=\"primary\"\n                type=\"submit\"\n                [disabled]=\"(isLoading$ | async) || addResidentFormGroup.invalid\">\n            Add\n        </button>\n    </div>\n</form>\n",
                "customCss" : ".al-form {\n    width: 840px;\n}\n\n.al-form .mat-mdc-dialog-content {\n    max-height: 80vh;\n}\n\n.al-form .mat-toolbar.mat-primary {\n    background: #fff;\n    color: rgba(0, 0, 0, 0.87);\n}\n\n.al-form .mat-mdc-button.mat-primary:not(:disabled), .al-form .mat-mdc-icon-button.mat-primary:not(:disabled), .al-form .mat-mdc-outlined-button.mat-primary:not(:disabled) {\n    color: #4B535B;\n}\n\n.al-form .mat-mdc-fab.mat-primary:not(:disabled), .al-form .mat-mdc-unelevated-button.mat-primary:not(:disabled), .al-form .mat-mdc-mini-fab.mat-primary:not(:disabled), .al-form .mat-mdc-raised-button.mat-primary:not(:disabled) {\n    color: #fff;\n}\n\n.al-form .mat-mdc-fab.mat-primary:not(:disabled), .al-form .mat-mdc-unelevated-button.mat-primary:not(:disabled), .al-form .mat-mdc-mini-fab.mat-primary:not(:disabled), .al-form .mat-mdc-raised-button.mat-primary:not(:disabled) {\n    background-color: #3E3AE3;\n}\n\n.al-form .mat-mdc-button .mat-mdc-button-persistent-ripple::before, .al-form .mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before, .al-form .mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before, .al-form .mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before {\n    background-color: #3E3AE3;\n}\n\n.al-form .mat-mdc-form-field .mdc-text-field--focused .mdc-floating-label {\n    color: #4B535B;\n}\n\n.al-form .mdc-text-field--filled .mdc-line-ripple::after {\n    border-bottom-color: #3E3AE3;\n}\n\n.al-form .mat-mdc-slide-toggle.mat-accent .mdc-switch.mdc-switch--selected.mdc-switch--checked .mdc-switch__handle::after, \n.al-form .mat-mdc-slide-toggle.mat-accent .mdc-switch.mdc-switch--selected.mdc-switch--checked .mdc-switch__ripple::after, \n.al-form .mat-mdc-slide-toggle.mat-accent .mdc-switch.mdc-switch--selected.mdc-switch--checked .mdc-switch__ripple::before {\n    background-color: #3E3AE3 !important;\n}\n\n.al-form .mat-mdc-slide-toggle.mat-accent .mdc-switch .mdc-switch__track::after {\n    background-color: rgba(111, 116, 242, 0.54) !important;\n}\n\n\n.al-form .mat-icon {\n    color: #9FA6B4;\n}\n\n.al-form .title-modal {\n    font-weight: 500;\n    font-size: 16px;\n    line-height: 130%;\n    color: #9FA6B4;\n    padding-bottom: 8px;\n}\n\n.al-form .mat-button-toggle-group-appearance-standard, .al-form .mat-button-toggle-standalone.mat-button-toggle-appearance-standard {\n    border: none;\n}\n\n.al-form .mat-button-toggle {\n    background: rgba(0, 0, 0, 0.06);\n    height: 32px;\n    align-items: center;\n    display: flex;\n}\n\n.al-form .mat-button-toggle-checked .mat-button-toggle-button {\n    background-color: #fff;\n    border-radius: 4px;\n    margin-left: 2px;\n    margin-right: 2px;\n}\n\n.al-form .mat-button-toggle-appearance-standard .mat-button-toggle-label-content {\n    line-height: 28px;\n    font-size: 14px;\n}\n\n.al-form .mat-button-toggle-group-appearance-standard .mat-button-toggle+.mat-button-toggle {\n    border-left: none;\n}\n\n.al-form .mat-button-toggle-checked.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay {\n    opacity: .01;\n}\n\n.al-form.mat-primary .mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled) .mdc-list-item__primary-text {\n    color: #4B535B;\n}\n\n.al-form .mat-mdc-slider .mdc-slider__thumb-knob,\n.al-form .mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb-knob,\n.al-form .mat-mdc-slider .mdc-slider__value-indicator,\n.al-form .mat-mdc-slider .mdc-slider__track--inactive {\n    background-color: #3E3AE3;\n}\n\n.al-form .mat-mdc-slider .mdc-slider__value-indicator::before {\n    border-top-color: #3E3AE3;\n}\n\n.al-form .mat-mdc-slider .mdc-slider__value-indicator {\n    opacity: 1;\n}\n\n.al-form .mat-mdc-slider .mdc-slider__track--active_fill,\n.al-form .mat-mdc-slider .mdc-slider__thumb-knob,\n.al-form .mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb-knob {\n    border-color: #3E3AE3;\n}\n\n\n.al-form .al-section-title {\n    width: 140px;\n    padding: 20px 0px;\n    font-weight: 500;\n    font-size: 14px;\n    line-height: 18px;\n    color: #29313C;\n}\n\n.al-form .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n    background: #F3F6FA;\n}\n\n.al-form .mdc-text-field--filled {\n    border-radius: 6px 6px 0px 0px;\n}\n\n",
                "customFunction" : "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet userService = $injector.get(widgetContext.servicesMap.get('userService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nopenAddResidentDialog();\n\nfunction openAddResidentDialog() {\n    customDialog.customDialog(htmlTemplate, AddResidentDialogController).subscribe();\n}\n\nfunction AddResidentDialogController(instance) {\n    let vm = instance;\n    \n    vm.customerId = null;\n    \n    const phoneNumberPattern = /^\\+[1-9]\\d{1,14}$/;\n    \n    vm.widgetContext = widgetContext;\n    \n    vm.addResidentFormGroup = vm.fb.group({\n      email: ['', [vm.validators.required, vm.validators.email]],\n      firstName: ['', [vm.validators.required]],\n      lastName: ['', [vm.validators.required]],\n      gender: [null],\n      phoneNumber: [null, [vm.validators.pattern(phoneNumberPattern)]],\n      birthdate: [null],\n      photo: [null, [vm.validators.required]],\n      emergencyFirstname: [''],\n      emergencyLastname: [''],\n      emergencyRole: [''],\n      emergencyPhoneNumber: [null, [vm.validators.pattern(phoneNumberPattern)]],\n      chronicDiseases: [''],\n      allergy: [''],\n      zone: [null, [vm.validators.required]],\n      room: [null, [vm.validators.required]],\n      wristband: [null, [vm.validators.required]]\n    });\n    \n    vm.genders = ['Male', 'Female'];\n    \n    vm.zones$ = getCustomerId().pipe(\n        widgetContext.rxjs.tap((customerId) => {\n            vm.customerId = customerId;\n        }),\n        widgetContext.rxjs.switchMap((ownerId) => {\n            var query = {\n                parameters: {\n                    rootId: ownerId.id,\n                    rootType: ownerId.entityType,\n                    direction: 'FROM',\n                    maxLevel: 1\n                },\n                relationType: 'Contains',\n                assetTypes: ['AL_Zone']\n            };\n            return assetService.findByQuery(query).pipe(\n                widgetContext.rxjs.map((zones) => {\n                    return zones.sort((z1, z2) => z1.name.localeCompare(z2.name));\n                })\n            );\n        }),\n        widgetContext.rxjs.share()\n    );\n    \n    vm.rooms$ = vm.addResidentFormGroup.get('zone').valueChanges.pipe(\n        widgetContext.rxjs.tap(() => {\n            vm.addResidentFormGroup.get('room').patchValue(null);\n        }),\n        widgetContext.rxjs.switchMap((zone) => {\n            if (zone) {\n                var query = {\n                    parameters: {\n                        rootId: zone.id.id,\n                        rootType: zone.id.entityType,\n                        direction: 'FROM',\n                        maxLevel: 1\n                    },\n                    relationType: 'Contains',\n                    assetTypes: ['AL_Room']\n                };\n                return assetService.findByQuery(query).pipe(\n                    widgetContext.rxjs.map((rooms) => {\n                        return rooms.sort((r1, r2) => r1.name.localeCompare(r2.name));\n                    })\n                );\n            } else {\n                return widgetContext.rxjs.of([]);\n            }\n        }),\n        widgetContext.rxjs.share()\n    );\n    \n    vm.wristbands$ = getCustomerId().pipe(\n        widgetContext.rxjs.switchMap((ownerId) => {\n           return getAvailableWristbands(ownerId);\n        }),\n        widgetContext.rxjs.share()\n    );\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n    vm.add = function() {\n        vm.addResidentFormGroup.markAsPristine();\n        saveEntityObservable(vm.customerId).subscribe(\n            function (entity) {\n                widgetContext.rxjs.forkJoin([\n                    saveRelations(vm.customerId, entity),\n                    saveAttributes(entity.id)\n                ]).subscribe(\n                    function () {\n                        widgetContext.updateAliases();\n                        vm.dialogRef.close(null);\n                    }\n                );\n            }\n        );\n    };\n    \n\n    function saveEntityObservable(ownerId) {\n        return getOrCreateResidentsUserGroup(ownerId).pipe(\n            widgetContext.rxjs.switchMap((residents) => {\n                const formValues = vm.addResidentFormGroup.value;\n                let resident = {\n                    email: formValues.email,\n                    firstName: formValues.firstName,\n                    lastName: formValues.lastName,\n                    customerId: ownerId,\n                    authority: 'CUSTOMER_USER'\n                };\n                return userService.saveUser(resident, false, residents.id.id);\n            })\n        );\n    }\n    \n    function saveRelations(ownerId, entity) {\n        let ownerRelation = {\n            type: 'Resident',\n            typeGroup: 'COMMON',\n            from: ownerId,\n            to: entity.id\n        };\n        let room = vm.addResidentFormGroup.get('room').value;\n        let roomRelation = {\n            type: 'Contains',\n            typeGroup: 'COMMON',\n            from: room.id,\n            to: entity.id\n        };\n        let wristband = vm.addResidentFormGroup.get('wristband').value;\n        return widgetContext.rxjs.forkJoin(\n            [\n                entityRelationService.saveRelation(ownerRelation),\n                entityRelationService.saveRelation(roomRelation),\n                assignWristband(entity, wristband.id)\n            ]\n        );\n    }\n    \n    function saveAttributes(entityId) {\n        let room = vm.addResidentFormGroup.get('room').value;\n        return attributeService.getEntityAttributes(room.id, 'SERVER_SCOPE', ['xPos', 'yPos']).pipe(\n            widgetContext.rxjs.switchMap((attributes) => {\n                let xPos = 0;\n                let yPos = 0;\n                for (var i = 0; i < attributes.length; i ++) {\n                    if (attributes[i].key === 'xPos') {\n                        xPos = attributes[i].value;\n                    } else if (attributes[i].key === 'yPos') {\n                        yPos = attributes[i].value;\n                    }\n                }\n                let photo = vm.addResidentFormGroup.get('photo').value;\n                let zone = vm.addResidentFormGroup.get('zone').value;\n                let gender = vm.addResidentFormGroup.get('gender').value;\n                let phoneNumber = vm.addResidentFormGroup.get('phoneNumber').value;\n                let birthdate = vm.addResidentFormGroup.get('birthdate').value;\n                if (birthdate) {\n                    birthdate = birthdate.getTime();\n                } else {\n                    birthdate = null;\n                }\n                let emergencyFirstname = vm.addResidentFormGroup.get('emergencyFirstname').value;\n                let emergencyLastname = vm.addResidentFormGroup.get('emergencyLastname').value;\n                let emergencyRole = vm.addResidentFormGroup.get('emergencyRole').value;\n                let emergencyPhoneNumber = vm.addResidentFormGroup.get('emergencyPhoneNumber').value;\n                let chronicDiseases = vm.addResidentFormGroup.get('chronicDiseases').value;\n                let allergy = vm.addResidentFormGroup.get('allergy').value;\n                let attributesArray = [\n                    {key: 'photo', value: photo},\n                    {key: 'gender', value: gender},\n                    {key: 'phoneNumber', value: phoneNumber},\n                    {key: 'birthdate', value: birthdate},\n                    {key: 'emergencyFirstname', value: emergencyFirstname},\n                    {key: 'emergencyLastname', value: emergencyLastname},\n                    {key: 'emergencyRole', value: emergencyRole},\n                    {key: 'emergencyPhoneNumber', value: emergencyPhoneNumber},\n                    {key: 'chronicDiseases', value: chronicDiseases},\n                    {key: 'allergy', value: allergy},\n                    {key: 'zone', value: zone.name},\n                    {key: 'room', value: room.name},\n                    {key: 'currentZone', value: zone.name},\n                    {key: 'currentRoom', value: room.name},\n                    {key: 'xPos', value: xPos},\n                    {key: 'yPos', value: yPos}\n                ];\n                return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n            })\n        );\n    }\n    \n    function assignWristband(entity, wristbandId) {\n        let newWristbandRelation = {\n            type: 'Use',\n            typeGroup: 'COMMON',\n            from: entity.id,\n            to: wristbandId\n        };\n        return deviceService.getDevice(wristbandId.id).pipe(\n            widgetContext.rxjs.switchMap((wristband) => {\n                return getAssignedUnassignedDeviceGroupIds().pipe(\n                    widgetContext.rxjs.switchMap((groupIds) => {\n                        wristband.label = entity.firstName + ' ' + entity.lastName;\n                        return widgetContext.rxjs.forkJoin([\n                            deviceService.saveDevice(wristband),\n                            entityRelationService.saveRelation(newWristbandRelation),\n                            entityGroupService.removeEntityFromEntityGroup(groupIds.unassignedGroupId, wristbandId.id),\n                            entityGroupService.addEntityToEntityGroup(groupIds.assignedGroupId, wristbandId.id)\n                        ]);\n                    })\n                );\n            })\n        );\n        \n    }\n    \n    function getAssignedUnassignedDeviceGroupIds() {\n        return widgetContext.rxjs.forkJoin([\n            getOrCreateEntityGroup(vm.customerId, 'DEVICE', 'Unassigned Devices'),\n            getOrCreateEntityGroup(vm.customerId, 'DEVICE', 'Assigned Devices')\n        ]).pipe(\n            widgetContext.rxjs.map((groups) => {\n              return { unassignedGroupId: groups[0].id.id, assignedGroupId: groups[1].id.id };\n            })\n        );\n    }\n    \n    function getOrCreateResidentsUserGroup(ownerId) {\n        return getOrCreateEntityGroup(ownerId, \"USER\", \"Residents\");\n    }\n    \n    function getAvailableWristbands(ownerId) {\n        const query = {\n            pageLink: {\n                pageSize: 100,\n                page: 0\n            },\n            entityFields: [\n                {\n                    type: 'ENTITY_FIELD',\n                    key: 'name'\n                }\n            ],\n            entityFilter: {\n                type: 'entitiesByGroupName',\n                groupType: 'DEVICE',\n                ownerId: ownerId,\n                entityGroupNameFilter: 'Unassigned Devices'\n            },\n            keyFilters: [\n                {\n                    key: {\n                        type: 'ENTITY_FIELD',\n                        key: 'type'\n                    },\n                    valueType: 'STRING',\n                    predicate: {\n                        type: 'STRING',\n                        operation: 'EQUAL',\n                        value: { defaultValue: 'AL_Wristband'},\n                        ignoreCase: false\n                    }\n                }\n            ]\n        };\n        return entityService.findEntityDataByQuery(query).pipe(\n            widgetContext.rxjs.map((pageData) => {\n                const wristbands = convertEntityPageDataToNameIdPairs(pageData);\n                wristbands.sort((w1, w2) => w1.name.localeCompare(w2.name));\n                return wristbands;\n            })\n        );\n    }\n    \n    function convertEntityPageDataToNameIdPairs(pageData) {\n        return pageData.data.map((entityData) => {\n            return convertEntityDataToNameIdPair(entityData);\n        });\n    }\n    \n    function convertEntityDataToNameIdPair(entityData) {\n        return {\n            id: entityData.entityId,\n            name: entityData.latest['ENTITY_FIELD']['name'].value\n        };\n    }\n    \n    function getOrCreateEntityGroup(ownerId, type, name) {\n      return getEntityGroupByName(ownerId, name, type).pipe(\n          widgetContext.rxjs.switchMap((group) => {\n              if (group) {\n                  return widgetContext.rxjs.of(group);\n              } else {\n                  var newGroup = {\n                    type: type,\n                    name: name,\n                    ownerId: ownerId\n                  };\n                  return entityGroupService.saveEntityGroup(newGroup);\n              }\n          })\n      );\n    }\n    \n    function getEntityGroupByName(ownerId, groupName, groupType) {\n      var entityGroupsPageLink = widgetContext.pageLink(10, 0, groupName);\n      return entityGroupService.getEntityGroupsByOwnerIdAndPageLink(ownerId.entityType, ownerId.id, groupType, entityGroupsPageLink, {ignoreLoading: true}).pipe(\n          widgetContext.rxjs.map((data) => {\n            if (data.data.length) {\n                return data.data.find((group) => group.name === groupName);\n            } else {\n                return null;\n            }\n          })\n      );\n    }\n    \n    function getCustomerId() {\n        const customerAliasId = widgetContext.aliasController.getEntityAliasId('Customer');\n        return widgetContext.aliasController.getAliasInfo(customerAliasId).pipe(\n            widgetContext.rxjs.map((info) => {\n              return {id: info.currentEntity.id, entityType: info.currentEntity.entityType};  \n            })\n        );\n    }\n\n}\n",
                "customResources" : [ ],
                "openInSeparateDialog" : false,
                "openInPopover" : false,
                "id" : "8114051d-0d61-1ae0-ecb2-d074c687c15c"
              } ]
            },
            "displayTimewindow" : true
          },
          "row" : 0,
          "col" : 0,
          "id" : "25c698ce-9c5d-a3f3-6684-234ac9d1550b"
        }
      },
      "states" : {
        "default" : {
          "name" : "device provisioning",
          "root" : true,
          "layouts" : {
            "main" : {
              "widgets" : {
                "f4dd3ce1-dd1c-94c6-5808-860b1f6d2978" : {
                  "sizeX" : 7,
                  "sizeY" : 8,
                  "row" : 4,
                  "col" : 0
                },
                "7f2ce774-59b7-0eb5-934f-c1a0a120ab95" : {
                  "sizeX" : 7,
                  "sizeY" : 4,
                  "row" : 0,
                  "col" : 0
                },
                "af12b1a5-aaa3-d308-fa5a-d4d7c64db04c" : {
                  "sizeX" : 5,
                  "sizeY" : 2,
                  "row" : 0,
                  "col" : 15
                },
                "143f9a9f-deb2-4895-1961-c0dfc4a0e85b" : {
                  "sizeX" : 6,
                  "sizeY" : 1,
                  "row" : 0,
                  "col" : 7
                },
                "5d547122-0ca8-7084-344b-b8e0ba333465" : {
                  "sizeX" : 7,
                  "sizeY" : 8,
                  "row" : 4,
                  "col" : 7
                },
                "25c698ce-9c5d-a3f3-6684-234ac9d1550b" : {
                  "sizeX" : 7,
                  "sizeY" : 3,
                  "row" : 1,
                  "col" : 7
                }
              },
              "gridSettings" : {
                "layoutType" : "default",
                "backgroundColor" : "#eeeeee",
                "columns" : 24,
                "margin" : 10,
                "outerMargin" : true,
                "backgroundSizeMode" : "100%"
              }
            }
          }
        }
      },
      "entityAliases" : {
        "131c2729-0e12-a73a-4b43-84d7b5d24315" : {
          "id" : "131c2729-0e12-a73a-4b43-84d7b5d24315",
          "alias" : "ALL DEVICES",
          "filter" : {
            "type" : "deviceSearchQuery",
            "resolveMultiple" : true,
            "rootStateEntity" : false,
            "stateEntityParamName" : null,
            "defaultStateEntity" : null,
            "rootEntity" : {
              "entityType" : "CURRENT_USER",
              "id" : "13814000-1dd2-11b2-8080-808080808080"
            },
            "direction" : "FROM",
            "maxLevel" : null,
            "fetchLastLevelOnly" : false,
            "relationType" : "User",
            "deviceTypes" : [ "thermostat", "INSIDE", "SoundBox", "SELIN", "LEFT" ]
          }
        },
        "76f33f21-5d98-eb94-7639-2c4f84e0285d" : {
          "id" : "76f33f21-5d98-eb94-7639-2c4f84e0285d",
          "alias" : "ALL ASSET",
          "filter" : {
            "type" : "assetSearchQuery",
            "resolveMultiple" : true,
            "rootStateEntity" : false,
            "stateEntityParamName" : null,
            "defaultStateEntity" : null,
            "rootEntity" : {
              "entityType" : "CURRENT_USER",
              "id" : "13814000-1dd2-11b2-8080-808080808080"
            },
            "direction" : "FROM",
            "maxLevel" : null,
            "fetchLastLevelOnly" : false,
            "relationType" : "Asset",
            "assetTypes" : [ "LANTAI" ]
          }
        }
      },
      "filters" : { },
      "timewindow" : {
        "displayValue" : "",
        "hideAggregation" : false,
        "hideAggInterval" : false,
        "hideTimezone" : false,
        "selectedTab" : 0,
        "realtime" : {
          "realtimeType" : 0,
          "interval" : 1000,
          "timewindowMs" : 60000,
          "quickInterval" : "CURRENT_DAY",
          "hideInterval" : false,
          "hideLastInterval" : false,
          "hideQuickInterval" : false
        },
        "history" : {
          "historyType" : 0,
          "interval" : 1000,
          "timewindowMs" : 60000,
          "fixedTimewindow" : {
            "startTimeMs" : 1759039802745,
            "endTimeMs" : 1759126202745
          },
          "quickInterval" : "CURRENT_DAY",
          "hideInterval" : false,
          "hideLastInterval" : false,
          "hideFixedInterval" : false,
          "hideQuickInterval" : false
        },
        "aggregation" : {
          "type" : "AVG",
          "limit" : 25000
        }
      },
      "settings" : {
        "stateControllerId" : "entity",
        "showTitle" : false,
        "showDashboardsSelect" : true,
        "showEntitiesSelect" : true,
        "showDashboardTimewindow" : true,
        "showDashboardExport" : true,
        "toolbarAlwaysOpen" : true
      }
    },
    "name" : "device provisioning",
    "resources" : null,
    "assignedCustomers" : null,
    "customerId" : null,
    "externalId" : null,
    "id" : {
      "entityType" : "DASHBOARD",
      "id" : "eedd1a30-9cfa-11f0-96fa-6b32df3ff77b"
    },
    "ownerId" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}